#-----------------------------------------------------------------------
# This Makefile installs M1QN3 in the CUTEr environment
#-----------------------------------------------------------------------

# The full pathname of the M1QN3 directory is set by removing the string
# '/cuter' from the end of the present directory pathname

M1QN3_DIR = $(PWD:/cuter=)

# Some useful directories

M1QN3_BIN_DIR = $(M1QN3_DIR)/bin
M1QN3_SRC_DIR = $(M1QN3_DIR)/src
M1QN3_SRC     = $(M1QN3_SRC_DIR)/m1qn3.f

# Include file

include $(M1QN3_DIR)/make.$(PLAT)

# Here are the files that are generated by this Makefile. Note that
# their name do not need to be quoted by the environment variable PLAT,
# since these files are already in the platform directory $MYCUTER.

MYCUTER_M1QN3       = $(MYCUTER)/bin/m1qn3
MYCUTER_SDM1QN3     = $(MYCUTER)/bin/sdm1qn3
MYCUTER_M1QN3_SPC   = $(CUTER)/common/src/pkg/m1qn3/m1qn3.spc
MYCUTER_M1QN3_OBJ   = $(MYCUTER)/double/bin/m1qn3.o
MYCUTER_M1QN3MA_OBJ = $(MYCUTER)/double/bin/m1qn3ma.o

all: $(MYCUTER_M1QN3) $(MYCUTER_SDM1QN3) $(MYCUTER_M1QN3_SPC) $(MYCUTER_M1QN3_OBJ) $(MYCUTER_M1QN3MA_OBJ)

#-----------------------------------------------------------------------

$(MYCUTER_M1QN3) $(MYCUTER_SDM1QN3) $(MYCUTER_M1QN3_SPC): make_sdm1qn3 m1qn3.spc
	make_sdm1qn3 $(SED_ERE_FLAG)

$(MYCUTER_M1QN3_OBJ): $(M1QN3_BIN_DIR)/m1qn3.$(PLAT).o
	rm -f $(MYCUTER_M1QN3_OBJ)
	ln -s $(M1QN3_BIN_DIR)/m1qn3.$(PLAT).o \
		$(MYCUTER_M1QN3_OBJ)

$(M1QN3_BIN_DIR)/m1qn3.$(PLAT).o: $(M1QN3_SRC)
	$(F90) $(F90FLAGS) $(F90NOLD) $(M1QN3_SRC) \
		-o $(M1QN3_BIN_DIR)/m1qn3.$(PLAT).o

$(MYCUTER_M1QN3MA_OBJ): $(M1QN3_BIN_DIR)/m1qn3ma.$(PLAT).o
	ln -s -f $(M1QN3_BIN_DIR)/m1qn3ma.$(PLAT).o \
		$(MYCUTER_M1QN3MA_OBJ) 

$(M1QN3_BIN_DIR)/m1qn3ma.$(PLAT).o: m1qn3ma.f90
	$(F90) $(F90FLAGS) $(F90NOLD) m1qn3ma.f90 \
		-o $(M1QN3_BIN_DIR)/m1qn3ma.$(PLAT).o

#-----------------------------------------------------------------------

purge:
	/bin/rm -f \
	   $(MYCUTER_M1QN3) \
	   $(MYCUTER_SDM1QN3) \
	   $(MYCUTER_M1QN3_SPC) \
	   $(MYCUTER_M1QN3_OBJ) \
	   $(MYCUTER_M1QN3MA_OBJ) \
	   $(M1QN3_BIN_DIR)/m1qn3.$(PLAT).o \
	   $(M1QN3_BIN_DIR)/m1qn3ma.$(PLAT).o
